# GraduationProject 项目日志
## 仿真平台：Intel I7 RAM 16G / Matlab for mac
## 到目前为止的效果：  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/simulation_6ROB_COLI_am.gif)

## Version: 1.0 02/02/2020
Author: HUO JIAXI. 

已完成单机器人的IP模型构建，通过调用基于CPLEX的Yalmip线性求解器成功求解最短路径，但是由于CPLEXcommunity版变量个数限制，环境规模被限制在5*5

## Version: 2.0 03/02/2020
Author: HUO JIAXI

调用Gurobi求解器，成功增大模型规模，目前暂时定为12*12，由于gurobi不限制变量个数，有增大模型规模的可能性，但是会造成比较长的延时。  

模型被成功求解，得到单个最短路径  

耗时24.957595秒.  

为多机器人系统搭建环境  

引入按次序执行路径规划的多机器人IP模型，求解成功，并且不会发生冲突，但是空间时间效率低，需要引入同步模型。
耗时为单个机器人运行时间的叠加，并且路径被单个机器人直接占用，未被释放，效率低，需改进。

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/Map12*12.jpg)
![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/Result12*12.jpg)  

1-AS ⬆️  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/3-MAS_12*12.jpg)  

3-MAS ⬆️
求解MAS模型耗时 79.981009s

## 对于优化MAS路径规划的一点想法：  
动态规划，暂时先不考虑启发式算法。
1. 先对每个机器人执行不考虑其他机器人存在的单机器人路径规划，将各机器人的最短路径存储在PATH.mat中，作为优先路径选择集合。
2. 正式开始启动系统，每个机器人按照优先路径行动，（for循环）每次行动存储实际所在位置在temp.mat中（暂定），并判断下一步节点是否与其他机器人优先路径集合中的下一节点重合（以及head-on-head collision需要另外考虑），或是和已经达到目的地的机器人的实际节点重合，若重合，或是停止等待，或是重新调用一次IP_solver求解器，求出新的无撞撞的路径选择，并对所有的机器人执行，直到所有的机器人达到目的节点，得到一个最终的路径cell集合pathcellfinal.matrix。

## Version: 2.1 04/02/2020  
Author: HUO JIAXI  

尝试将系统动态化  

根据昨天的想法，我尝试将想法实例化，目前代码运行正常，但是耗时长久。  

需要初始化路径，即将所有个体机器人在不考虑其他机器人存在的情况下计算出可行的最优路径，作为首选集合存储。而之后则需要考虑到其他机器人的存在，所以我同步运行所有的机器人，每一个时间节点都会判断一次冲突情况，若有冲突，则重新规划路径，而对于重新规划路径而言，则需要更新环境，需要将所有机器人的下一节点作为障碍物，使得发生冲突的机器人不会在更新过后的路径中的下一节点发生冲突。  

最后的temp.matrix矩阵包含了所有机器人的最终目的地。  

之后的任务则是优化现有的模型，想办法引入新的启发式算法，减小耗时。  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/MAS_syn_base.jpg)

现有模型耗时 80.381949s  

## Version 3.0 05/02/2019  
Author: HUO JIAXI  

3.0版本将求解MAS模型所得到的优化路径动态化，并且作为mp4视频文件作为运行结果存储。  

在调试代码的过程中，发现如果仍然将已经达到目的地的机器人作为障碍物放置在环境中，会造成很大的资源浪费（造成一整条线路无法通行），因此考虑一种情况，到达目的地的机器人会进行捡货等操作，会离开现有环境，因此可以将与已经达到终点的机器人发生碰撞的情况忽略（但是在程序运行结果中需要指出，如下图）。  

在这样的条件下，可以避免一些非必要的堵塞情况。  

为了提高结果的视觉效果，将系统初始的机器人状态定为黄色圆点，达到终点的机器人状态定为绿色圆点，而运行中的机器人定为红色圆点，这样可以提高结果的可读性。  

不足：耗时仍然较长，并且避碰算法仍需要改进，在调试过程中发现head-on-head冲突没有被避免，只能避免对角处的冲突，需要进一步调试代码。  

6台机器人运行耗时：224.504326s    

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/MAS_COLI_BASE.png)

## Version 4.0 06/02/2020  
Author: HUO JIAXI  

4.0版本已经实现多机器人系统的对角冲突以及非交叉冲突，需要进一步调试交叉冲突的躲避方法。  

6台机器人运行耗时：359.223416s  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/version4.0.png)

## Version 4.1 07/02/2020
Author: HUO JIAXI

4.1版本实现了非交叉冲突的优化设计，并且调试成功了交叉冲突的躲避方法。但是对于终点在某一时刻被包围的情况还是没有得到非常好的优化，容易造成求解器错误，但是以目前的环境密度，4.1版本能够实现7机器人环境的优化路径规划。  

不足：需要优化搜寻方法，效率太低，特别是对于终点被包围的情况，求解器很难求解，需要设置备用终点，备用终点的选取也需要优化。

7台机器人运行耗时：481.073032s  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/version4.1results.png)

## Version 4.1 08/02/2019
Author: HUO JIAXI  

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/时间分配结果4.1.png)

经过分析，由于原始路径的规划需要对每个机器人进行全图搜寻，导致在原始路径的规划中耗费了非常多的时间，另外对于解决冲突的算法，也对出现冲突的机器人进行全图搜寻（4.0版本需要对每对冲突机器人的每个个体进行全图搜寻，所导致的资源浪费更加严重，4.1版本对其进行优化，只需选定一个机器人进行重新规划即可，冲突即可得到解除）。全图搜寻的效率比较低，调用Gurobi耗费大量的时间，所以对于启发式算法，可以考虑对全图的分割。不进行原始路径的规划，而是对于每个时刻进行逐个阶段规划以及冲突解除，可以根据机器人个体的起始点和终点设定对于每个机器人个体不同的全图分割方式，以缩短模型的状态空间。

## Version 4.2 09/02/2020
Author: HUO JIAXI  

4.2版本将备用终点的启用集成在function文件中，能够在一定程度上降低时间时延，根据仿真结果，能够降低50s左右的延时。  

另外4.2版本实现了对终点被包围但是其附近存在0点的情况下进行备用终点启用的方法。通过不断对备用终点的判断，得到可行的备用终点。但是发现了新的问题：  

现有的IP模型在求解路径失败的情况下无法判断路径被堵塞的情况，导致后续的冲突接触存在困难。在调用路径修改程序时无法准确启用备用终点或是备用起点，起点被包围的情况无法和终点被包围的情况分开。  

7机器人环境运行耗时：432.608s

![images](https://github.com/HUOJIAXI/GraduationProject/blob/master/results/Version4.2.png)

## Version 4.2 10/02/2020  
Author: HUO JIAXI  

考虑到现行版本很高的时延，并且障碍解除不稳定。对于现行版本的优化，考虑先优化避障方法。而较高的时延很大一部分在于发生冲突时求解Modify_IP函数的IP模型所需要的时间很长。  

由于冲突的产生是在两个机器人即将碰撞的时刻发生，因此对于原始最佳路径的修改不需要扩展到整个环境中，可以在原始最佳路径上进行修改。  

考虑在规划避障修改路线时不将原最佳路径的终点作为Modify_IP函数的终点，而是将环境图中取出包含机器人实际位置的一正方形部分，将该部分与原最佳路径的靠近原始终点的交点作为Modify_IP函数的终点。原因是修改之后的路径并不会与原最佳路径偏移太多。  

此时求解Modify_IP函数的IP模型所对应的IP模型会大大减小，只需要求解对应的一部分环境。考虑到环境中的障碍物为2x1大小，因此考虑求解修改路径的IP模型环境为以机器人实际位置为中心的3x3的正方形环境。可行性仍有待验证，将可行性分析作为4.3版本进行探究。
